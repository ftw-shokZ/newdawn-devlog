---
layout: post
title: "Clanwar System Modernization: Day Recap"
date: 2025-05-25
thumbnail: /newdawn-devlog/assets/thumbs/post-4.png
tags: [Clanwar, System, Refactor, Status]
---

> *â€œO, code foul and riddled with â€˜shitâ€™, thy time hath come.  
> Let logic reign where chaos once danced.â€*  
> â€” William Debugspeare

---

## ğŸ› ï¸ New Dawn Modernization Recap: May 25th Edition

Today we sliced, diced, and refactored the **New Dawn Clanwar system** with surgical precision â€” and a flamethrower. What began as a simple cleanup turned into a full-blown exorcism of `DisableShit()` and friends. Letâ€™s get into it:

---

### âš™ï¸ Total Rewrite. Cleaner. Meaner. Shit-free ğŸ’©.
We looked into the abyss of the old codebase... and the abyss looked back at us with functions named `DisableShit()`, variables like `return shit;`, and logic that screamed **"please refactor me."**
So, we did what had to be done.

The original code was powered by prayers and duct tape.  
- `DisableShit()` ğŸ¤¨ vanished.
- `return shit;` flushed.
- `shit++;` replaced by ?.

We proudly present: **New Dawn v2.5 â€“ 100% SHIT-FREEâ„¢** ğŸ§» 
Certified by 3AM coders and rubber duck debuggers worldwide.

---

### âœ… Refactor Blitz â€“ Now With 80% More Enum

- `/startmap` and `/stopmap` now respect `CWInfo[RoundStatus]` â€” not chaos.
- The old `Map` variable? Retired. Replaced with real enums that mean something.
- Full rewrites for `CheckDrivers`, `CarCheck`, and `SpawnPlayers`, all using `foreach` and `STATE_*`.

RIP `Map = 1`, you wonâ€™t be missed.

---

### ğŸ§  Smarter Logic (Now With Water Death Supportâ„¢)

- Players who drowned now **actually die** (and get listed, sorry Kevin).
- TrainMode and EvenMode moved into `CWInfo[]` â€“ no more rogue globals.
- Round ending logic cleaned up with fewer edge cases than a broken jigsaw puzzle.
- `UpdateAliveCounts()` now shows `--` only when it makes sense.

---

### â±ï¸ Countdown Logic 2.0 â€“ RIP `StartCountDown3, 2, GO`

- Full revamp with `StartCountDown()` and `CountdownTick()` â†’ clear, readable, actually works.
- HUD updates in sync. Sounds fire off at the right moment.
- Players get unlocked like it's Payday.

Old countdown logic?  
Let's just say it went to `DisableShit()` heaven.

---

### ğŸ¨ UI, HUD & Message Cleanup

We color-coded everything like itâ€™s a visual novel:
- `[INFO]` = Calm.
- `[SETTING]` = Fresh.
- `[DEBUG]` = Mysterious.
- `[CLANWAR]` = Boss-mode.
- `[WARNING]` = â€œYou sure about that?â€
- `[FIX]` = Ahhh yes, the duct tape color.

Late join now has its own toggle via `/togjoin` (admin-approved).
Team joining is smarter, with protection against mid-match chaos.  
And if you see a message like:  
> *(mooman): â€œStrawberries!â€*  
â€¦just smile. The random spawn quotes are live. ğŸ‘€

---

### ğŸ§± System Split: maploader vs clanwar

We drew the line in the sand:

- `maploader.inc` â€“ handles everything world-related:
  - Vehicle spawn
  - Pickup management
  - Weather, water, spawnmode, etc.
- `clanwar.inc` â€“ controls the warzone:
  - Round state
  - Alive counters
  - Scoreboard logic
  - Spectator stuff

Clean structure. No more 2-in-1 potluck includes.

---

### ğŸ§¯ Bugfixes & Features

- `/fixspawn` â€“ if youâ€™re under the map, this is your lifeline.
- Water deaths now correctly count as â€œyeah heâ€™s gone.â€
- `SendToSpectate()` refined to work under all live-round conditions.
- Team selection now appears for players joining **during** CW â€” but **only if** they arenâ€™t assigned.
- `AllowLateJoin` logic wired in â€” toggle it on/off depending on how generous you're feeling.

---

## â˜‘ï¸ Whatâ€™s Next?

- A full scoreboard rewrite.
- Stats saving and match logs.
- Kill the last remaining signs of `ShitLegacy()` and remove any lingering `ReturnTrash()`.

---

## ğŸ“¸ Screenshots

### ğŸ—ºï¸ Status, Spectator and Alive Counter

![Status](https://ftw-shokz.github.io/newdawn-devlog/assets/status.png)

---

> *â€œRefactor softly and carry a big semicolon.â€*

Catch you in the next push.  
â€” Jonny

---
