---
layout: post
title: "Clanwar System Modernization: Day Recap"
date: 2025-05-25
thumbnail: /newdawn-devlog/assets/thumbs/post-4.png
tags: [Clanwar, System, Refactor, Status]
---

> *‚ÄúFrom legacy to legendary ‚Äì one cleanup at a time.‚Äù*

---

## üõ†Ô∏è Today's Clanwar Modernization Recap

We've made significant progress on bringing the **New Dawn Clanwar system** up to modern standards. Here's a breakdown of the improvements:

---

### ‚úÖ Code & Logic Refactors

- Rewrote the `/startmap` and `/stopmap` commands to use `CWInfo[RoundStatus]` instead of loose conditions.
- Removed `Map` as a tracking variable and fully replaced it with meaningful enums.
- Modernized the `CheckDrivers`, `CarCheck`, and `SpawnPlayers` logic to use player states and cleaned loops with `foreach`.

---

### üß† Logic Fixes & Improvements

- Fixed edge cases where players dying in water didn‚Äôt trigger round end or deathlist updates.
- Implemented smarter logic to handle late joiners via `AllowLateJoin` setting.
- Rewrote the round winner logic to account for `TrainMode` properly.
- Replaced `Even` and `Train` global variables with `CWInfo[]` structured state.
- Rewrote `UpdateAliveCounts()` to reset alive counter to `--` only when players are not spawned.

---

### ‚è±Ô∏è Countdown System Revamp

- Clean, readable countdown logic (`StartCountDown`, `CountdownTick`)
- New sound feedback and HUD behavior
- Final tick unlocks players and enables action

---

### üé® UI & Presentation

- Color-coded system messages across:
  - `[INFO]`, `[SETTING]`, `[CLANWAR]`, `[FIX]`, `[WARNING]`, `[DEBUG]`, `[ERROR]`
- Improved the login HUD and late join behavior.
- Added late join toggle via `/togjoin` and refined team join restrictions.

---

### üîÅ Modularization & Cleanup

- Split `maploader.inc` and `clanwar.inc` based on responsibility:
  - `maploader` now handles all map-related logic: loading vehicles, pickups, world settings.
  - `clanwar` handles game state, team data, round control, and scoreboard logic.

---

### ‚úÖ Remaining Known Tasks

- Added `/fixspawn` command to fix your spawn if bugged under the map after the Countdown stopped.
- Re-evaluate `CheckClanWarStatus()` logic to better handle players joining during `CW_STATUS_ACTIVE`.

---

More to come. One step at a time ‚Äì system by system.